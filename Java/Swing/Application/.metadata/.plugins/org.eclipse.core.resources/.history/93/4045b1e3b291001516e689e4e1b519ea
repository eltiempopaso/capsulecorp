package Dynatac.Bus;

import java.net.ServerSocket;
import java.io.IOException;
import java.net.Socket;
import java.util.ArrayList;
import java.util.List;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.PrintStream;

import Dynatac.Bus.IDynatacBus.IDynatacBusSuscriptor;


public class DynatacBusBridge implements IDynatacBus {
	private List<IDynatacBusSuscriptor > suscriptors_ = new ArrayList<IDynatacBusSuscriptor>();
		
	private BufferedReader inputBuffer_ = null;
	private PrintStream    outputBuffer_ = null;
	
	IDynatacBus busLeft_, busRight_;
	
	class DynatacBusBridge_DynatacBusSuscriptor implements IDynatacBusSuscriptor {
		
		private IDynatacBus dataDestinationBus_ = null;
		
		DynatacBusBridge_DynatacBusSuscriptor (IDynatacBus dataDestinationBus) {
			
			dataDestinationBus_ = dataDestinationBus;			
		}
		
		public void dataAvailable(String data) {
			dataDestinationBus_.write(data);
		}
	}
	
	private DynatacBusBridge_DynatacBusSuscriptor busLeftSuscriptor_ = null;
	private DynatacBusBridge_DynatacBusSuscriptor busRightSuscriptor_ = null;
	
	
	/// Constructor
	public DynatacBusBridge (IDynatacBus aBusLeft, IDynatacBus aBusRight) {
		
		busLeft_  = aBusLeft;
		busRight_ = aBusRight;
		
		busLeftSuscriptor_ = new  DynatacBusBridge_DynatacBusSuscriptor(busRight_);
		busRightSuscriptor_ = new  DynatacBusBridge_DynatacBusSuscriptor(busLeft_);
		
		busLeft_.setOnDataAvailable(busLeftSuscriptor_);
		busRight_.setOnDataAvailable(busRightSuscriptor_);
		
		//new Thread (this).start();
	}
	
	/* IDynatacBus methods*/
	public void write(String data) {
		busLeft_.write(data);
		busRight_.write(data);
	}

	public void setOnDataAvailable(IDynatacBusSuscriptor s) {
		if (!suscriptors_.contains(s))
		{
			suscriptors_.add(s);
		}
	}

	protected void notifySuscriptors (String data)
	{
		for (int z = 0; z<suscriptors_.size(); z++)
		{
			IDynatacBusSuscriptor s = suscriptors_.get(z);
			
			s.dataAvailable(data);
		}
	}
	
	public void dataAvailable(String data) {
				
	}

	/* Runnable methods */
	public void run() {
		
		while (true)
		{
	
		}
	}
}
	
